<!DOCTYPE html>
<html>
<head>
    <title>3D Model Generator</title>
</head>

<body>
    <form id="prompt-form">
        <label for="prompt">Enter a prompt:</label>
        <input type="text" id="prompt" name="prompt">
        <input type="submit" value="Generate 3D Model">
    </form>


    <div id="canvas-container"></div>

    <script type = "module" src="./render.js"></script>
    

    <script type="module">

        document.getElementById('prompt-form').addEventListener('submit', function(event) {
            event.preventDefault();

            var prompt = document.getElementById('prompt').value;


            fetch('http://localhost:5000/generate_3d', {
                method: 'POST',
                mode: 'cors',
                headers: {
                    'Origin': 'http://127.0.0.1:8080',
                    'Content-Type': 'application/json',
                    'Access-Control-Allow-Origin': '*'

                },
                body: JSON.stringify({ prompt: prompt })
            })
            .then(response => response.blob())
            .then(blob => {
                console.log('3d model generated')
                var url = URL.createObjectURL(blob);
                var loader = new THREE.OBJLoader();

                loader.load(url, function(object) {
                    var scene = new THREE.Scene();
                    var camera = new THREE.PerspectiveCamera(75, window.innerWidth / window.innerHeight, 0.1, 1000);
                    var renderer = new THREE.WebGLRenderer();

                    renderer.setSize(window.innerWidth, window.innerHeight);
                    document.body.appendChild(renderer.domElement);

                    scene.add(object);
                    camera.position.z = 5;

                    var animate = function() {
                        requestAnimationFrame(animate);
                        renderer.render(scene, camera);
                    };

                    animate();
                }); 
            });
        });
    </script>
</body>
</html>
